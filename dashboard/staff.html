<!DOCTYPE html>
<html lang="id">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <title>Dashboard Peserta â€” LMS (Motion One, Framer-like)</title>

    <!-- Tailwind CDN -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Chart.js -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <!-- Motion One (vanilla animations by Framer team) -->
    <script src="https://cdn.jsdelivr.net/npm/@motionone/dom/dist/motion.min.js"></script>

    <link
      href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700;800&display=swap"
      rel="stylesheet"
    />
    <style>
      :root {
        --brand: #a80308;
        --muted: #6b7280;
        --card-shadow: 0 10px 30px rgba(2, 6, 23, 0.06);
      }
      body {
        font-family: "Inter", sans-serif;
        color: #111827;
      }
      .card {
        background: #fff;
        border-radius: 12px;
        box-shadow: var(--card-shadow);
      }
      /* small timeline line style if present */
      .timeline-line {
        position: absolute;
        left: 2rem;
        width: 4px;
        background: #111827;
        border-radius: 2px;
        transform-origin: top;
        transform: scaleY(0);
      }

      /* Chart sizing to avoid zero-size canvas */
      .chart-box { width: 100%; max-width: 220px; height: 140px; }
      .chart-box canvas { width: 100% !important; height: 100% !important; display: block; }

      /* progress fallback */
      .progress-fill { transition: width 350ms ease; }

      /* small helpers used elsewhere */
      .legend-dot { display:inline-block; border-radius:3px; }
    </style>
  </head>

  <body class="font-[Inter] text-[#0b1220] bg-white">
    <!-- NAVBAR -->
    <nav class="relative bg-white border-b-2 border-gray-200 mb-2 lg:mb-4">
      <div class="flex items-center justify-between px-2 md:px-4 py-3 lg:px-8 md:py-4">
        <div class="flex items-center gap-3">
          <img src="../img/logo.png" alt="Logo" class="w-8 md:w-10" />
          <a href="../home/public.html" class="text-base font-semibold text-black hover:bg-gray-100 px-3 py-1 rounded-full">Home</a>
          <div class="hidden lg:flex items-center gap-2 md:gap-4 ml-2">
            <a href="../dashboard/staff.html" class="text-base font-semibold text-black hover:bg-gray-100 px-3 py-1 rounded-full">Dashboard</a>
            <a href="../learningpath/index.html" class="text-base font-semibold text-black hover:bg-gray-100 px-3 py-1 rounded-full">Learning Path</a>
            <a href="#" class="text-base font-semibold text-black hover:bg-gray-100 px-3 py-1 rounded-full">Site Administrator</a>
          </div>
        </div>

        <div class="flex items-center gap-3">
          <img src="../img/notif.png" alt="notification" class="w-4 h-5 md:w-6 md:h-8 rounded-lg inline-block" />
          <button id="mobileNavToggle" class="lg:hidden inline-flex items-center justify-center p-2 rounded-md focus:outline-none" aria-expanded="false" aria-controls="mobileMenu">
            <svg id="hamburgerIcon" class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24" aria-hidden="true"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16"></path></svg>
            <svg id="closeIcon" class="w-6 h-6 hidden" fill="none" stroke="currentColor" viewBox="0 0 24 24" aria-hidden="true"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path></svg>
          </button>

          <div class="text-end hidden lg:block">
            <p class="font-bold">Nama Pengguna</p>
            <p class="text-gray-400 text-[11px]">Learning Staff</p>
          </div>
          <img src="../img/pp.png" alt="Profile" class="w-10 h-10 rounded-lg hidden lg:inline-block" />
        </div>
      </div>

      <!-- Mobile dropdown menu -->
      <div id="mobileMenu" class="lg:hidden overflow-hidden bg-white" style="display: none; transform: scaleY(0); opacity: 0" aria-hidden="true">
        <div class="px-2 pb-4 pt-2 space-y-1">
          <a href="../dashboard/staff.html" class="block px-3 py-2 rounded-md text-xs font-medium text-black hover:bg-gray-100">Dashboard</a>
          <a href="../course/user.html" class="block px-3 py-2 rounded-md text-xs font-medium text-black hover:bg-gray-100">MyCourse</a>
          <a href="#" class="block px-3 py-2 rounded-md text-xs font-medium text-black hover:bg-gray-100">Site Administrator</a>

          <div class="mt-2 border-t pt-2 flex items-center gap-3 px-3">
            <img src="../img/pp.png" alt="notif" class="w-6 h-6 rounded" />
            <div>
              <p class="font-semibold text-sm">Nama Pengguna</p>
              <p class="text-xs text-gray-500">Learning Staff</p>
            </div>
          </div>
        </div>
      </div>
    </nav>

    <main class="mx-2 md:mx-4 lg:mx-8 mb-12 page-content">
      <!-- HERO -->
      <section class="flex flex-col gap-2 lg:gap-6 h-70 md:flex-row">
        <div id="heroContent" class="text-white bg-black rounded-xl md:rounded-2xl flex-3 md:w-2/3 p-4 lg:p-8 my-auto">
          <h1 class="mb-1 md:mb-3 md:max-w-4xl text-lg lg:text-4xl font-bold capitalize">Alur proses pembelian dan pelunasan cabang</h1>
          <p class="mb-1 md:mb-3 max-w-3xl text-xs lg:text-lg">Memberikan pemahaman menyeluruh tentang alur kerja pembelian barang hingga proses pembayaran kepada supplier.</p>

          <!-- Progress (hero) -->
          <div class="flex mb-1 md:mb-3 justify-between items-center text-xs md:text-sm text-gray-500 progress-wrapper">
            <div class="w-[87%] md:w-[90%] bg-gray-200 rounded h-1 relative">
              <div class="progress-fill bg-[#a80308] h-1 rounded absolute left-0 top-0" style="width: 0%" role="progressbar" aria-valuemin="0" aria-valuemax="100" aria-valuenow="0"></div>
            </div>
            <span class="progress-text pl-1 md:pl-2">3 / 13</span>
          </div>

          <a href="../course/user.html" class="inline-block px-3 py-2 lg:px-6 lg:py-3 text-xs md:text-sm lg:text-base font-semibold text-white transition-colors rounded-lg bg-[#a80308] hover:bg-[#8a0206]">Lanjutkan</a>
        </div>

        <div class="flex-1 flex flex-col gap-1 md:gap-3 capitalize py-2 px-2 lg:py-4">
          <h3 class="font-bold text-base lg:text-xl">Upcoming</h3>
          <div class="border-l-2 border-red-700 pl-2 h-12 flex flex-col justify-center">
            <h6 class="font-semibold text-sm lg:text-base">Prosedur penanganan komplain konsumen</h6>
            <p class="text-xs">12/10/2025</p>
          </div>
          <div class="border-l-2 border-red-700 pl-2 h-12 flex flex-col justify-center">
            <h6 class="font-semibold text-sm lg:text-base">Prosedur close sales order</h6>
            <p class="text-xs">15/10/2025</p>
          </div>
          <div class="border-l-2 border-red-700 pl-2 h-12 flex flex-col justify-center">
            <h6 class="font-semibold text-sm lg:text-base">Prosedur pengecekan kendaraan harian</h6>
            <p class="text-xs">17/10/2025</p>
          </div>
        </div>
      </section>

      <!-- Dashboard -->
      <section class="my-6 grid grid-cols-1 lg:grid-cols-8 gap-4 items-stretch">
        <!-- Donut -->
          <div
            class="col-span-1 md:col-span-4 lg:col-span-2 bg-[#FFF4E5] rounded-lg shadow p-4 flex flex-col items-center justify-between"
          >
            <div class="w-45 h-45 2xl:w-45 2xl:h-45 mb-2"><canvas id="donutChart"></canvas></div>

            <div class="flex-1 flex gap-x-6 items-center text-xs">
              <div class="flex items-center">
                <span class="legend-dot w-3 h-3 mr-1 bg-[#388E3C] block rounded-sm"></span>
                <div class="text-xs text-gray-500">Selesai</div>
              </div>
              <div class="flex items-center">
                <span class="legend-dot w-3 h-3 mr-1 bg-[#FFB300] block rounded-sm"></span>
                <div class="text-xs text-gray-500">Berlangsung</div>
              </div>
              <div class="flex items-center">
                <span class="legend-dot w-3 h-3 mr-1 bg-[#A80308] block rounded-sm"></span>
                <div class="text-xs text-gray-500">Belum Mulai</div>
              </div>
            </div>
          </div>

        <!-- Big stat cards -->
        <div class="col-span-1 md:col-span-4 grid grid-cols-2 gap-4">
          <div class="stat-card bg-[#FFDAB3] rounded-lg py-4 px-2 md:px-8 shadow h-40 md:h-44 flex flex-col justify-between text-center">
            <div class="text-xl md:text-3xl font-semibold text-black">Jumlah Pelatihan Harus Diikuti</div>
            <div class="text-5xl md:text-6xl font-bold text-black"><span class="stat-value" data-stat="harus">12</span></div>
          </div>
          <div class="stat-card bg-[#FFF4E5] rounded-lg py-4 px-2 md:px-8 shadow h-40 md:h-44 flex flex-col justify-between text-center">
            <div class="text-xl md:text-3xl font-semibold text-black">Pelatihan Berlangsung</div>
            <div class="text-5xl md:text-6xl font-bold text-black"><span class="stat-value" data-stat="berlangsung">3</span></div>
          </div>
          <div class="stat-card bg-[#DFF5E1] rounded-lg py-4 px-2 md:px-8 shadow h-40 md:h-44 flex flex-col justify-between text-center">
            <div class="text-xl md:text-3xl font-semibold text-black">Pelatihan Selesai</div>
            <div class="text-5xl md:text-6xl font-bold text-black"><span class="stat-value" data-stat="selesai">8</span></div>
          </div>
          <div class="stat-card bg-[#FFE5E5] rounded-lg py-4 px-2 md:px-8 shadow h-40 md:h-44 flex flex-col justify-between text-center">
            <div class="text-xl md:text-3xl font-semibold text-black">Pelatihan Belum Dimulai</div>
            <div class="text-5xl md:text-6xl font-bold text-black"><span class="stat-value" data-stat="belum">1</span></div>
          </div>
        </div>

        <!-- Leaderboard -->
        <div class="col-span-1 md:col-span-2 bg-[#FFDAB3] rounded-lg shadow p-4">
          <h4 class="font-bold text-black text-xl mb-3">Peringkat Saya</h4>
          <ol class="flex flex-col space-y-3 leaderboard">
            <li class="flex items-center gap-3 border-b border-[#FFB300]">
              <div class="font-semibold w-5 text-end">50.</div>
              <div class="flex justify-between text-black items-center w-full">
                <div class="font-medium">Wardah Cahyani</div>
                <div>40</div>
              </div>
            </li>
            <li class="flex items-center gap-3 border-b border-[#FFB300]">
              <div class="font-semibold w-5 text-end">1.</div>
              <div class="flex justify-between text-black items-center w-full">
                <div class="font-medium">Ervia Oktavia</div>
                <div>300</div>
              </div>
            </li>
            <li class="flex items-center gap-3 border-b border-[#FFB300]">
              <div class="font-semibold w-5 text-end">2.</div>
              <div class="flex justify-between text-black items-center w-full">
                <div class="font-medium">Sarah Amelia</div>
                <div>290</div>
              </div>
            </li>
            <li class="flex items-center gap-3 border-b border-[#FFB300]">
              <div class="font-semibold w-5 text-end">3.</div>
              <div class="flex justify-between text-black items-center w-full">
                <div class="font-medium">Yoga Lesmana</div>
                <div>280</div>
              </div>
            </li>
            <li class="flex items-center gap-3 border-b border-[#FFB300]">
              <div class="font-semibold w-5 text-end">4.</div>
              <div class="flex justify-between text-black items-center w-full">
                <div class="font-medium">Zaki Ammar</div>
                <div>270</div>
              </div>
            </li>
            <li class="flex items-center gap-3 border-b border-[#FFB300]">
              <div class="font-semibold w-5 text-end">5.</div>
              <div class="flex justify-between text-black items-center w-full">
                <div class="font-medium">Valencia</div>
                <div>260</div>
              </div>
            </li>
          </ol>
        </div>
      </section>

      <!-- Aktivitas Terbaru -->
      <section class="my-6">
        <h2 class="px-4 py-2 text-sm md:text-lg lg:text-3xl font-bold text-white bg-[#A80308] rounded-xl">Aktivitas Terbaru</h2>
        <div class="bg-white px-2 md:px-4">
          <ul class="divide-y text-sm md:text-base text-black">
            <li class="py-3 flex gap-4 md:gap-20 activity-row">
              <div class="w-32 md:w-36 font-bold">3 Agustus 2025</div>
              <div class="flex-1">Menyelesaikan "Product Knowledge 1"</div>
            </li>
            <li class="py-3 flex gap-4 md:gap-20 activity-row">
              <div class="w-32 md:w-36 font-bold">1 Agustus 2025</div>
              <div class="flex-1">Mulai "Soft Skills: Komunikasi Efektif"</div>
            </li>
            <li class="py-3 flex gap-4 md:gap-20 activity-row">
              <div class="w-32 md:w-36 font-bold">30 Juli 2025</div>
              <div class="flex-1">Mengerjakan kuis ERP Modul 1</div>
            </li>
            <li class="py-3 flex gap-4 md:gap-20 activity-row">
              <div class="w-32 md:w-36 font-bold">28 Juli 2025</div>
              <div class="flex-1">Memberikan feedback untuk course</div>
            </li>
            <li class="py-3 flex gap-4 md:gap-20 activity-row">
              <div class="w-32 md:w-36 font-bold">26 Juli 2025</div>
              <div class="flex-1">Menyelesaikan "Alur Proses Penjualan dan Pelunasan Piutang"</div>
            </li>
          </ul>
        </div>
      </section>

      <!-- Pelatihan Selesai -->
      <section id="pelatihan" class="my-4 lg:my-8">
        <div class="flex flex-col mb-1 md:mb-4">
          <h2
            class="px-4 py-2 text-sm md:text-lg lg:text-3xl font-bold text-white bg-[#A80308] rounded-xl"
          >
            Pelatihan Selesai
          </h2>
        </div>

        <!-- SEARCH bar wrapper -->
        <div class="mt-6">
          <form
            onsubmit="handleSearch(event)"
            class="w-full mt-4 mx-auto"
            role="search"
            aria-label="Cari kursus"
          >
            <div class="hero-search-wrap rounded-lg p-2 md:p-3">
              <div class="flex flex-col md:flex-row md:items-center gap-3">
                <div
                  class="flex items-center bg-[#E7E7E7] text-[#898989] rounded-md px-3 py-2 flex-1 h-9 min-w-0 search-input"
                >
                  <label for="q" class="sr-only">Cari kursus</label>
                  <input
                    id="q"
                    type="search"
                    name="q"
                    class="min-w-0 w-full bg-transparent border-0 outline-none text-black placeholder-gray-500 text-sm"
                    placeholder="Cari kursus..."
                    aria-label="Cari kursus"
                  />
                  <button
                    type="submit"
                    class="ml-3 inline-flex items-center gap-2 rounded-md px-3 py-1 text-sm font-semibold text-[#898989] bg-transparent btn-focus"
                    aria-label="Cari"
                  >
                    <svg
                      class="w-4 h-4"
                      viewBox="0 0 24 24"
                      fill="none"
                      aria-hidden="true"
                    >
                      <path
                        d="M21 21l-4.35-4.35"
                        stroke="currentColor"
                        stroke-width="2"
                        stroke-linecap="round"
                        stroke-linejoin="round"
                      />
                      <circle
                        cx="11"
                        cy="11"
                        r="6"
                        stroke="currentColor"
                        stroke-width="2"
                      />
                    </svg>
                    <span class="hidden md:inline">Search</span>
                  </button>
                </div>

                <div
                  class="flex flex-col md:flex-row md:items-center gap-2 w-full md:w-auto select-group"
                >
                  <div class="w-full md:w-auto select-shrink">
                    <label class="sr-only" for="kategori">Kategori</label>
                    <select
                      id="kategori"
                      name="kategori"
                      class="w-full md:w-auto block rounded-md px-3 py-2 text-xs md:text-sm border border-white/10 bg-[#E7E7E7] text-[#898989] outline-none"
                    >
                      <option value="">Kategori</option>
                      <option value="mandatory">Mandatory</option>
                      <option value="functional-sop">Functional SOP</option>
                      <option value="functional-skill">Functional Skill</option>
                      <option value="development">Development</option>
                    </select>
                  </div>
                  <div class="w-full md:w-auto select-shrink">
                    <label class="sr-only" for="status">Status</label>
                    <select
                      id="status"
                      name="status"
                      class="w-full md:w-auto block rounded-md px-3 py-2 text-xs md:text-sm border border-white/10 bg-[#E7E7E7] text-[#898989] outline-none"
                    >
                      <option value="">Status</option>
                      <option value="private">Private</option>
                      <option value="public">Public</option>
                    </select>
                  </div>
                  <div class="w-full md:w-auto select-shrink">
                    <label class="sr-only" for="progress">Progress</label>
                    <select
                      id="progress"
                      name="progress"
                      class="w-full md:w-auto block rounded-md px-3 py-2 text-xs md:text-sm border border-white/10 bg-[#E7E7E7] text-[#898989] outline-none"
                    >
                      <option value="">Progress</option>
                      <option value="not-started">Belum Dimulai</option>
                      <option value="in-progress">Berlangsung</option>
                      <option value="completed">Selesai</option>
                    </select>
                  </div>
                </div>
              </div>
            </div>
          </form>
        </div>

        <div
          id="courseGrid"
          class="grid gap-2 md:gap-6 grid-cols-2 lg:grid-cols-3 mt-6"
        >
          <!-- CARD 1 -->
          <article
            class="card-item bg-white rounded-lg overflow-hidden shadow flex flex-col h-full"
          >
            <div
              class="flex justify-between items-center px-3 py-2 gap-2 text-sm font-semibold"
            >
              <div title="Terbuka">ðŸ”“</div>
              <span
                class="bg-[#28A745] text-white px-1 md:px-3 py-0.5 md:py-1 text-[8px] md:text-base rounded-sm md:rounded-lg"
                >Selesai</span
              >
            </div>

            <div class="w-full h-auto overflow-hidden">
              <img
                src="../img/course1.png"
                alt="course 1"
                class="w-full h-full object-cover"
              />
            </div>

            <div class="flex-1 flex flex-col">
              <div class="md:p-4 w-full">
                <div
                  class="flex justify-between items-center text-[#898989] progress-wrapper"
                >
                  <div
                    class="w-[80%] 2xl:w-[85%] bg-[#E7E7E7] rounded h-1 relative progress-bar"
                  >
                    <div
                      class="progress-fill bg-[#a80308] h-1 rounded absolute left-0 top-0"
                      style="width: 0%"
                      role="progressbar"
                      aria-valuemin="0"
                      aria-valuemax="100"
                      aria-valuenow="0"
                    ></div>
                  </div>
                  <span class="progress-text text-[8px] md:text-base px-1"
                    >14 / 14</span
                  >
                </div>
              </div>

              <h4 class="text-xs md:text-2xl font-bold text-center h-auto">
                ALUR PROSES PENERIMAAN PESANAN
              </h4>
            </div>
          </article>

          <!-- CARD 2 -->
          <article
            class="card-item bg-white rounded-lg overflow-hidden shadow flex flex-col h-full"
          >
            <div
              class="flex justify-between items-center px-3 py-2 gap-2 text-sm font-semibold"
            >
              <div title="Terbuka">ðŸ”“</div>
              <span
                class="bg-[#FFB300] text-white px-1 md:px-3 py-0.5 md:py-1 text-[8px] md:text-base rounded-sm md:rounded-lg"
                >Lanjutkan</span
              >
            </div>

            <div class="w-full h-auto overflow-hidden">
              <img
                src="../img/course2.png"
                alt="course 2"
                class="w-full h-full object-cover"
              />
            </div>

            <div class="flex-1 flex flex-col">
              <div class="md:p-4 w-full">
                <div
                  class="flex justify-between items-center text-[#898989] progress-wrapper"
                >
                  <div
                    class="w-[80%] 2xl:w-[85%] bg-[#E7E7E7] rounded h-1 relative progress-bar"
                  >
                    <div
                      class="progress-fill bg-[#a80308] h-1 rounded absolute left-0 top-0"
                      style="width: 0%"
                      role="progressbar"
                      aria-valuemin="0"
                      aria-valuemax="100"
                      aria-valuenow="0"
                    ></div>
                  </div>
                  <span class="progress-text text-[8px] md:text-base px-1"
                    >10 / 10</span
                  >
                </div>
              </div>

              <h4 class="text-xs md:text-2xl font-bold text-center h-16">
                PROSES PEMBUATAN DOKUMEN SALES ORDER (SO)
              </h4>
            </div>
          </article>

          <!-- CARD 3 -->
          <article
            class="card-item hidden lg:flex bg-white rounded-lg overflow-hidden shadow flex-col h-full"
          >
            <div
              class="flex justify-between items-center px-3 py-2 gap-2 text-sm font-semibold"
            >
              <div title="Terkunci">ðŸ”’</div>
              <span
                class="bg-[#a80308] text-white px-1 md:px-3 py-0.5 md:py-1 text-[8px] md:text-base rounded-sm md:rounded-lg"
                >Mulai</span
              >
            </div>

            <div class="w-full h-auto overflow-hidden">
              <img
                src="../img/course3.png"
                alt="course 3"
                class="w-full h-full object-cover"
              />
            </div>

            <div class="flex-1 flex flex-col">
              <div class="md:p-4 w-full">
                <div
                  class="flex justify-between items-center text-[#898989] progress-wrapper"
                >
                  <div
                    class="w-[80%] 2xl:w-[85%] bg-[#E7E7E7] rounded h-1 relative progress-bar"
                  >
                    <div
                      class="progress-fill bg-[#a80308] h-1 rounded absolute left-0 top-0"
                      style="width: 0%"
                      role="progressbar"
                      aria-valuemin="0"
                      aria-valuemax="100"
                      aria-valuenow="0"
                    ></div>
                  </div>
                  <span class="progress-text text-[8px] md:text-base px-1"
                    >6 / 6</span
                  >
                </div>
              </div>

              <h4 class="text-xs md:text-2xl font-bold text-center h-16">
                PERSIAPAN PENGIRIMAN BARANG
              </h4>
            </div>
          </article>
        </div>
      </section>
    </main>

    <!-- Scripts (chart + motion animations + small behaviours) -->
    <script>
      // ---------- Mobile nav using Motion One ----------
      function initMobileNav() {
        const toggle = document.getElementById("mobileNavToggle");
        const menu = document.getElementById("mobileMenu");
        const hamburgerIcon = document.getElementById("hamburgerIcon");
        const closeIcon = document.getElementById("closeIcon");
        if (!toggle || !menu) return;

        toggle.setAttribute("aria-expanded", "false");
        menu.setAttribute("aria-hidden", "true");
        menu.style.display = "none";
        menu.style.transform = "scaleY(0)";
        menu.style.opacity = "0";
        menu.style.transformOrigin = "top";

        let open = false;
        let currentAnim = null;
        const animateApi = window.motion && window.motion.animate ? window.motion : null;

        const openMenu = () => {
          if (currentAnim && currentAnim.cancel) currentAnim.cancel();
          menu.style.display = "block";
          menu.style.transformOrigin = "top";
          if (animateApi) {
            currentAnim = animateApi.animate(menu, { scale: [0.95, 1], opacity: [0, 1] }, { duration: 280, easing: "cubic-bezier(.2,.9,.2,1)" });
            // don't strictly depend on finished, but ensure styles set after animation
            currentAnim.finished?.finally(() => {
              menu.style.transform = "none";
              menu.style.opacity = "1";
              currentAnim = null;
            });
          } else {
            menu.style.transform = "none";
            menu.style.opacity = "1";
          }
          toggle.setAttribute("aria-expanded", "true");
          menu.setAttribute("aria-hidden", "false");
          hamburgerIcon.classList.add("hidden");
          closeIcon.classList.remove("hidden");
          open = true;
        };

        const closeMenu = () => {
          if (!open) return;
          if (currentAnim && currentAnim.cancel) currentAnim.cancel();
          const animateClose = animateApi
            ? animateApi.animate(menu, { scale: [1, 0.95], opacity: [1, 0] }, { duration: 220, easing: "ease-in" })
            : null;
          toggle.setAttribute("aria-expanded", "false");
          menu.setAttribute("aria-hidden", "true");
          hamburgerIcon.classList.remove("hidden");
          closeIcon.classList.add("hidden");
          if (animateClose) {
            animateClose.finished?.finally(() => {
              menu.style.display = "none";
              menu.style.transform = "scaleY(0)";
              menu.style.opacity = "0";
              currentAnim = null;
            });
          } else {
            menu.style.display = "none";
            menu.style.transform = "scaleY(0)";
            menu.style.opacity = "0";
          }
          open = false;
        };

        toggle.addEventListener("click", (e) => {
          e.stopPropagation();
          if (open) closeMenu(); else openMenu();
        });

        document.addEventListener("click", (ev) => {
          if (!open) return;
          if (!menu.contains(ev.target) && !toggle.contains(ev.target)) closeMenu();
        });

        window.addEventListener("scroll", () => { if (open) closeMenu(); }, { passive: true });
        window.addEventListener("resize", () => { if (window.innerWidth >= 1024 && menu.style.display !== "none") closeMenu(); });
      }

      // ---------- Helpers ----------
      function readIntFromEl(el) {
        if (!el) return 0;
        const txt = (el.textContent || el.innerText || "").trim();
        const cleaned = txt.replace(/[^\d\-]/g, "");
        const n = parseInt(cleaned, 10);
        return isNaN(n) ? 0 : n;
      }
      function getStatsFromDOM() {
        const nodes = document.querySelectorAll(".stat-value[data-stat]");
        const result = { harus: 0, berlangsung: 0, selesai: 0, belum: 0 };
        nodes.forEach((n) => {
          const key = n.getAttribute("data-stat");
          const val = readIntFromEl(n);
          if (key && Object.prototype.hasOwnProperty.call(result, key))
            result[key] = val;
        });
        return result;
      }

      // ---------- Chart (ensure canvas has size) ----------
      let donutChart = null;
      function createDonut(initialData) {
        const el = document.getElementById("donutChart");
        if (!el) return;
        const ctx = el.getContext("2d");
        if (donutChart) try { donutChart.destroy(); } catch (e) {}
        donutChart = new Chart(ctx, {
          type: "doughnut",
          data: {
            labels: ["Selesai", "Berlangsung", "Belum Mulai"],
            datasets: [{ data: initialData, backgroundColor: ["#388E3C", "#FFB300", "#A80308"], borderWidth: 0 }]
          },
          options: { maintainAspectRatio: false, plugins: { legend: { display: false } }, cutout: "60%", responsive: true }
        });
      }
      function updateChartFromDOM() {
        const s = getStatsFromDOM();
        const data = [s.selesai, s.berlangsung, s.belum];
        if (!donutChart) createDonut(data);
        else {
          donutChart.data.datasets[0].data = data;
          donutChart.update();
        }
      }

      // ---------- Progress (Motion One) ----------
      function parseProgressText(text) {
        const m = String(text).match(/(\d+)\s*\/\s*(\d+)/);
        if (!m) return null;
        return [parseInt(m[1], 10), parseInt(m[2], 10)];
      }
      function updateProgress(wrapper) {
        const span = wrapper.querySelector(".progress-text");
        const fill = wrapper.querySelector(".progress-fill");
        if (!span || !fill) return;
        const nums = parseProgressText(span.textContent);
        if (!nums) {
          fill.style.width = "0%";
          fill.setAttribute("aria-valuenow", 0);
          return;
        }
        const [cur, total] = nums;
        const pct = total === 0 ? 0 : Math.max(0, Math.min(100, (cur / total) * 100));
        const animateApi = window.motion && window.motion.animate ? window.motion : null;
        if (animateApi) {
          animateApi.animate(fill, { width: [`0%`, `${pct}%`] }, { duration: 700, easing: [0.22, 1, 0.36, 1] });
        } else {
          fill.style.width = pct + "%";
        }
        fill.setAttribute("aria-valuenow", cur);
        fill.setAttribute("aria-valuemax", total);
        fill.setAttribute("aria-valuemin", 0);
      }
      function initProgressWrappers() {
        const wrappers = document.querySelectorAll(".progress-wrapper");
        wrappers.forEach((wrapper) => {
          updateProgress(wrapper);
          const span = wrapper.querySelector(".progress-text");
          if (span) {
            const mo = new MutationObserver(() => updateProgress(wrapper));
            mo.observe(span, { characterData: true, childList: true, subtree: true });
          }
        });
      }

      // ---------- Entrance animations (staggered) ----------
      function entranceAnimations() {
        const animateApi = window.motion && window.motion.animate ? window.motion : null;
        const groups = [
          Array.from(document.querySelectorAll(".stat-card")),
          Array.from(document.querySelectorAll(".leaderboard li")),
          Array.from(document.querySelectorAll(".activity-row")),
          Array.from(document.querySelectorAll(".card-item, .course-card"))
        ];

        groups.forEach((group, gIdx) => {
          if (!group || group.length === 0) return;
          group.forEach((el, idx) => {
            el.style.opacity = "0";
            el.style.transform = "translateY(10px)";
            const delay = 0.2 + gIdx * 0.06 + idx * 0.05;
            if (animateApi) {
              animateApi.animate(el, { opacity: [0, 1], transform: ["translateY(10px)", "translateY(0px)"] }, { delay: delay * 1000, duration: 600, easing: [0.22, 1, 0.36, 1] });
            } else {
              setTimeout(() => { el.style.opacity = "1"; el.style.transform = "translateY(0)"; }, delay * 1000);
            }
          });
        });

        // optional marker pulse
        const animateMarker = document.querySelector(".marker.bg-[#a80308], #activeMarker, .marker.active");
        if (animateMarker && window.motion && window.motion.animate) {
          window.motion.animate(animateMarker, { transform: ["scale(1)", "scale(1.06)", "scale(1)"] }, { duration: 1800, easing: [0.22, 1, 0.36, 1], iterations: Infinity });
        }
      }

      // ---------- Timeline line ----------
      function animateTimelineLine() {
        const container = document.querySelector(".lg\\:col-span-3, .timeline-wrapper");
        if (!container) return;
        if (container.querySelector(".timeline-line")) return;
        const line = document.createElement("div");
        line.className = "timeline-line";
        line.style.position = "absolute";
        line.style.left = "2rem";
        line.style.width = "4px";
        line.style.background = "#111827";
        line.style.borderRadius = "2px";
        line.style.top = "20px";
        line.style.bottom = "20px";
        line.style.transformOrigin = "top";
        line.style.transform = "scaleY(0)";
        container.style.position = container.style.position || "relative";
        container.appendChild(line);
        const animateApi = window.motion && window.motion.animate ? window.motion : null;
        if (animateApi) {
          animateApi.animate(line, { transform: ["scaleY(0)", "scaleY(1.06)", "scaleY(0.98)", "scaleY(1)"] }, { duration: 900, easing: [0.22, 1, 0.36, 1] });
        } else {
          line.style.transform = "scaleY(1)";
        }
      }

      // ---------- Search / filter ----------
      function filterCourseGrid(q) {
        const grid = document.getElementById("courseGrid") || document.getElementById("doneGrid");
        if (!grid) return;
        const items = Array.from(grid.querySelectorAll(".card-item, .course-card"));
        const term = String(q || "").trim().toLowerCase();
        items.forEach((card) => {
          const titleEl = card.querySelector("h4") || card.querySelector(".text-2xl") || card;
          const title = ((titleEl && (titleEl.textContent || titleEl.innerText)) || "").toLowerCase();
          if (!term || title.includes(term)) card.style.display = ""; else card.style.display = "none";
        });
      }
      function attachSearchHandler() {
        const input = document.getElementById("q") || document.getElementById("searchInput");
        if (!input) return;
        input.addEventListener("input", function () { filterCourseGrid(this.value); });
      }
      function handleSearch(event) { if (event && event.preventDefault) event.preventDefault(); const input = document.getElementById("q") || document.getElementById("searchInput"); filterCourseGrid(input ? input.value : ""); }

      // ---------- Init ----------
      document.addEventListener("DOMContentLoaded", function () {
        try {
          initMobileNav();
          updateChartFromDOM();
          initProgressWrappers();
          entranceAnimations();
          animateTimelineLine();
          attachSearchHandler();

          // observe stat nodes to update chart automatically
          const statNodes = document.querySelectorAll(".stat-value[data-stat]");
          statNodes.forEach((node) => {
            const mo = new MutationObserver(() => updateChartFromDOM());
            mo.observe(node, { characterData: true, childList: true, subtree: true });
          });
        } catch (err) {
          console.error("Init error:", err);
        }
      });
    </script>
  </body>
</html>
